<div class="registerMain">
  <div class="map-section">
    <div class="map-container">
      <google-map
        #mapInstance="googleMap"
        height="100%"
        width="100%"
        [options]="mapOptions"
        [center]="mapCenter"
        (mapClick)="onMapClick($event)"
        (mapInitialized)="onMapInitialized(mapInstance.googleMap)"
      >
        <map-marker
          [position]="markerPosition!"
          [options]="markerOptions"
          (mapDragend)="onMarkerDragEnd($event)"
        >
        </map-marker>
      </google-map>

      <div class="map-search-overlay">
        <div class="search-container input-group mb-3">
          <input
            type="text"
            [(ngModel)]="searchQuery"
            placeholder="Search for an area, street, or landmark"
            class="form-control search-input"
            (keyup.enter)="onSearchLocation()"
            name="searchQuery"
          />
          <button
            class="btn btn-primary search-button"
            type="button"
            (click)="onSearchLocation()"
          >
            <mat-icon>search</mat-icon>
          </button>
        </div>
      </div>

      <div *ngIf="isLoadingLocation" class="loading-overlay">
        <mat-spinner diameter="50"></mat-spinner>
        <p>Fetching location details...</p>
      </div>

      <div class="selected-location-box" *ngIf="form.get('addressLine1')?.value">
        <div class="location-details">
          <p class="selected-location-heading">Selected Location</p>
          <p class="selected-address">{{ form.get('addressLine1')?.value }}</p>
          <p class="selected-address">{{ form.get('city')?.value }}, {{ form.get('state')?.value }} {{ form.get('postalCode')?.value }}</p>
          <p class="selected-address">{{ form.get('country')?.value }}</p>
        </div>
      </div>
    </div>
  </div>

  <div class="register-form-card-main">
    <div class="register-form-card-container">
      <div class="form-header-content">
        <h2 class="form-title">Register Your Restaurant</h2>
        <p class="form-subtitle">Fill in the details to get started with your restaurant profile</p>
      </div>

      <form [formGroup]="form" (ngSubmit)="onSubmit()" class="form-content">
        <mat-form-field appearance="outline" class="full-width-input">
          <mat-label>Restaurant Name</mat-label>
          <input matInput formControlName="businessName" placeholder="Enter restaurant name" />
          <mat-error
            *ngIf="form.get('businessName')?.hasError('required') && form.get('businessName')?.touched"
          >
            Restaurant Name is required.
          </mat-error>
        </mat-form-field>

        <div class="row">
          <div class="col-md-6">
            <mat-form-field appearance="outline" class="full-width-input">
              <mat-label>FSSAI License Number</mat-label>
              <input
                matInput
                formControlName="fssaiNumber"
                placeholder="e.g. 12345678901234"
              />
              <mat-error
                *ngIf="form.get('fssaiNumber')?.hasError('required') && form.get('fssaiNumber')?.touched"
              >
                FSSAI License Number is required.
              </mat-error>
            </mat-form-field>
          </div>
          <div class="col-md-6">
            <mat-form-field appearance="outline" class="full-width-input">
              <mat-label>GST Number</mat-label>
              <input
                matInput
                formControlName="gstNumber"
                placeholder="e.g. 22AAAAA0000A1Z5"
              />
              <mat-error
                *ngIf="form.get('gstNumber')?.hasError('required') && form.get('gstNumber')?.touched"
              >
                GST Number is required.
              </mat-error>
            </mat-form-field>
          </div>
        </div>

        <mat-form-field appearance="outline" class="full-width-input">
          <mat-label>Restaurant Phone Number</mat-label>
          <input
            matInput
            type="number"
            formControlName="contactNumber"
            placeholder="Enter phone number"
            maxlength="10"
          />
          <mat-error
            *ngIf="form.get('contactNumber')?.hasError('required') && form.get('contactNumber')?.touched"
          >
            Contact Number is required.
          </mat-error>
          <mat-error
            *ngIf="form.get('contactNumber')?.hasError('minlength') && form.get('contactNumber')?.touched"
          >
            Contact Number must be 10 digits.
          </mat-error>
          <mat-error
            *ngIf="form.get('contactNumber')?.hasError('maxlength') && form.get('contactNumber')?.touched"
          >
            Contact Number must be 10 digits.
          </mat-error>
        </mat-form-field>

        <div class="form-divider">
            <h3 class="divider-title">Restaurant Address</h3>
            <button type="button" class="btn btn-link btn-select-from-map" (click)="onSearchLocation()">
                <mat-icon fontSet="material-icons-outlined" class="me-1">map</mat-icon>Select from map
            </button>
        </div>

        <mat-form-field appearance="outline" class="full-width-input">
          <mat-label>Address Line 1</mat-label>
          <textarea
            matInput
            formControlName="addressLine1"
            placeholder="123 Main Street"
            rows="2"
          ></textarea>
          <mat-error
            *ngIf="form.get('addressLine1')?.hasError('required') && form.get('addressLine1')?.touched"
          >
            Address Line 1 is required.
          </mat-error>
        </mat-form-field>

        <div class="row">
          <div class="col-md-6">
            <mat-form-field appearance="outline" class="full-width-input">
              <mat-label>City</mat-label>
              <input matInput formControlName="city" placeholder="New York" />
              <mat-error
                *ngIf="form.get('city')?.hasError('required') && form.get('city')?.touched"
              >
                City is required.
              </mat-error>
            </mat-form-field>
          </div>
          <div class="col-md-6">
            <mat-form-field appearance="outline" class="full-width-input">
              <mat-label>State</mat-label>
              <input matInput formControlName="state" placeholder="NY" />
              <mat-error
                *ngIf="form.get('state')?.hasError('required') && form.get('state')?.touched"
              >
                State is required.
              </mat-error>
            </mat-form-field>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6">
            <mat-form-field appearance="outline" class="full-width-input">
              <mat-label>Pincode/Zip</mat-label>
              <input
                matInput
                formControlName="postalCode"
                placeholder="10001"
                maxlength="6"
                type="number"
              />
              <mat-error
                *ngIf="form.get('postalCode')?.hasError('required') && form.get('postalCode')?.touched"
              >
                Pincode/Zip is required.
              </mat-error>
              <mat-error
                *ngIf="form.get('postalCode')?.hasError('maxlength') && form.get('postalCode')?.touched"
              >
                Pincode/Zip cannot exceed 6 digits.
              </mat-error>
            </mat-form-field>
          </div>
          <div class="col-md-6">
            <mat-form-field appearance="outline" class="full-width-input">
              <mat-label>Country</mat-label>
              <input
                matInput
                formControlName="country"
                placeholder="United States"
              />
              <mat-error
                *ngIf="form.get('country')?.hasError('required') && form.get('country')?.touched"
              >
                Country is required.
              </mat-error>
            </mat-form-field>
          </div>
        </div>

        <input type="hidden" formControlName="latitude" />
        <input type="hidden" formControlName="longitude" />

        <div class="form-footer">
          <button
            type="submit"
            class="btn btn-warning w-100 py-2 register-submit-btn"
            [disabled]="form.invalid || isSubmitting"
          >
            {{ isSubmitting ? 'Submitting...' : 'Submit' }}
          </button>
        </div>
      </form>
    </div>
    <div class="AnotherLogin">
      <p class="mt-4">
        Already have an account?<span
          style="color: blue; cursor: pointer"
          routerLink="/auth"
        >
          Log in</span
        >
      </p>
    </div>
  </div>
</div>